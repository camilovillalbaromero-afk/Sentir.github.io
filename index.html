<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>EmotionSpace - App Móvil</title>
    <style>
        :root {
            --bg-color: white;
            --text-color: #2c3e50;
            --card-bg-color: white;
            --card-border-color: #f0f0f0;
            --subtle-bg-color: #f8f9ff;
            --tab-nav-bg: white;
            --tab-nav-border: #e0e0e0;
            --primary-accent: #667eea;
            --secondary-text-color: #666;
            --positive-color: #4CAF50;
            --negative-color: #F44336;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg-color: #2a2a2a;
            --card-border-color: #404040;
            --subtle-bg-color: #333;
            --tab-nav-bg: #2a2a2a;
            --tab-nav-border: #404040;
            --secondary-text-color: #aaa;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden; /* Evita el scroll del body si el contenido interno tiene scroll */
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* App Container - Esto simula el "marco" del celular */
        .app-container {
            max-width: 400px; /* Ancho típico de un celular */
            width: 100%;
            height: 90vh; /* Altura para simular la pantalla */
            margin: 0 auto;
            background: var(--bg-color);
            color: var(--text-color);
            position: relative;
            overflow-y: auto; /* Permite scroll dentro del contenedor de la app */
            overflow-x: hidden;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 30px; /* Bordes redondeados del celular */
            box-shadow: 0 0 0 10px rgba(0,0,0,0.1), /* Borde exterior */
                        0 0 0 12px #333, /* Borde más oscuro como chasis */
                        0 20px 50px rgba(0,0,0,0.4); /* Sombra para profundidad */
            -webkit-overflow-scrolling: touch; /* Suaviza el scroll en iOS */
        }

        /* Status Bar */
        .status-bar {
            height: 44px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            width: 100%; /* Asegura que ocupe todo el ancho del app-container */
        }

        /* Tab Navigation */
        .tab-navigation {
            position: sticky; /* Cambiado a sticky para que flote al final del contenido o de la pantalla si hay poco */
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            background: var(--tab-nav-bg);
            border-top: 1px solid var(--tab-nav-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
            padding-bottom: env(safe-area-inset-bottom);
            width: 100%; /* Asegura que ocupe todo el ancho del app-container */
        }

        .tab-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 6px 8px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            color: var(--secondary-text-color);
        }

        .tab-item.active {
            background: linear-gradient(135deg, #667eea20, #764ba240);
            color: var(--primary-accent);
        }

        .tab-item .icon { font-size: 18px; margin-bottom: 4px; }
        .tab-item .label { font-size: 10px; font-weight: 600; }

        /* Content Sections */
        .content-section {
            display: none;
            padding: 20px;
            /* No need for padding-bottom: 100px here as the tab-navigation is sticky/fixed */
            min-height: calc(100% - 44px); /* Altura restante después de la status bar */
            box-sizing: border-box; /* Incluye padding en el cálculo de altura */
        }
        /* Ajuste para que el contenido no se quede por debajo de la barra de navegación al final del scroll */
        .content-section:last-of-type {
            padding-bottom: 100px; /* Asegura espacio para la barra de navegación al final del contenido */
        }


        .content-section.active { display: block; }
        .section-header { text-align: center; margin-bottom: 24px; }

        .section-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-subtitle { font-size: 16px; color: var(--secondary-text-color); opacity: 0.8; }
        
        .card {
            background: var(--card-bg-color);
            border-radius: 20px;
            padding: 24px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 1px solid var(--card-border-color);
        }

        /* Video Container */
        .video-container {
            background: var(--card-bg-color);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .video-embed { position: relative; width: 100%; height: 0; padding-bottom: 56.25%; overflow: hidden; border-radius: 12px; }
        .video-embed iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* Emotion & Stat Cards */
        .emotions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .emotion-card {
            background: var(--card-bg-color);
            border: 2px solid var(--card-border-color);
            border-radius: 20px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer; position: relative; overflow: hidden; min-height: 160px;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .emotion-card:active { transform: scale(0.95); }
        .emotion-card.active { transform: scale(1.05); box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3); border-color: #667eea; }
        .emotion-icon { width: 50px; height: 50px; margin: 0 auto 12px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; animation: pulse 2s infinite; }
        .emotion-name { font-size: 16px; font-weight: 700; color: var(--text-color); margin-bottom: 8px; text-align: center; }
        .level-bar { height: 6px; background: #f0f0f0; border-radius: 3px; overflow: hidden; margin-top: 8px; }
        .level-fill { height: 100%; border-radius: 3px; transition: width 1s ease-out; background: linear-gradient(90deg, #667eea, #764ba2); }
        .level-percentage { font-size: 12px; font-weight: 600; color: var(--secondary-text-color); text-align: center; margin-top: 4px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 20px; }
        .stat-card, .diary-stat-card { background: var(--card-bg-color); border: 2px solid var(--card-border-color); border-radius: 16px; padding: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .stat-number, .diary-stat-number { font-size: 32px; font-weight: 800; color: var(--primary-accent); margin-bottom: 8px; line-height: 1; }
        .stat-label, .diary-stat-label { color: var(--secondary-text-color); font-weight: 600; font-size: 12px; }

        /* Floating Action Button */
        .fab { 
            position: fixed; 
            bottom: 100px; /* Ajustado para estar sobre la barra de navegación */
            right: calc(50% - 200px + 20px); /* Centra la app y luego lo desplaza a la derecha */
            width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; color: white; font-size: 24px; cursor: pointer; box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); transition: all 0.3s ease; z-index: 999; 
        }
        /* Media query para ajustar FAB si la pantalla es más pequeña que el max-width del contenedor */
        @media (max-width: 420px) {
            .fab {
                right: 20px; /* Vuelve a la derecha normal si la pantalla es pequeña */
            }
        }
        .fab:active { transform: scale(0.9); }

        /* Buttons */
        .btn-mobile { padding: 16px 24px; border: none; border-radius: 16px; font-weight: 600; cursor: pointer; font-size: 16px; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
        .btn-secondary { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3); }
        .btn-success { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3); }
        .btn-mobile:active { transform: scale(0.98); }
        .control-buttons { display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
        .control-buttons.row { flex-direction: row; justify-content: center; gap: 16px; }

        /* Mood Selection */
        .mood-input { display: flex; justify-content: space-around; margin-top: 20px; }
        .mood-emoji { width: 60px; height: 60px; font-size: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; transition: all 0.3s ease; background: #f8f9fa; }
        .mood-emoji:active { transform: scale(0.9); }
        .mood-emoji.selected { background: linear-gradient(135deg, #667eea, #764ba2); transform: scale(1.1); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4); }

        /* Breathing Circle */
        .breathing-circle { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); margin: 20px auto; animation: breathe 4s infinite; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; font-weight: 600; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        /* Game Styles */
        .game-area { width: 100%; height: 250px; background: var(--subtle-bg-color); border-radius: 12px; margin-top: 16px; position: relative; overflow: hidden; }
        .bubble { position: absolute; bottom: -20px; background: rgba(102, 126, 234, 0.5); border-radius: 50%; animation: float 5s infinite; cursor: pointer; }
        @keyframes float { 0% { transform: translateY(0); } 100% { transform: translateY(-300px); } }

        /* Memory Game Styles */
        .memory-game-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 100%; height: 300px; padding: 12px; box-sizing: border-box; }
        .memory-card { background: var(--subtle-bg-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 28px; cursor: pointer; transition: transform 0.6s; transform-style: preserve-3d; position: relative; }
        .memory-card.flip { transform: rotateY(180deg); }
        .memory-card .front-face, .memory-card .back-face { position: absolute; backface-visibility: hidden; }
        .memory-card .front-face { transform: rotateY(180deg); }
        .memory-card.match .front-face { color: var(--positive-color); }
        .game-score { display: flex; justify-content: space-around; font-size: 14px; font-weight: 600; margin-bottom: 16px; }

        /* Modal Styles */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: flex-end; z-index: 2000; }
        .modal.show { display: flex; }
        .modal-content { background: var(--card-bg-color); border-radius: 20px 20px 0 0; padding: 24px; width: 100%; max-height: 80vh; overflow-y: auto; transform: translateY(100%); transition: transform 0.3s ease; }
        .modal.show .modal-content { transform: translateY(0); }
        .modal-header { display: flex; align-items: center; margin-bottom: 20px; gap: 16px; }
        .modal-emoji { width: 60px; height: 60px; font-size: 30px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: linear-gradient(135deg, #f8f9ff, #e8f4f8); }
        .close-btn { position: absolute; top: 16px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .advice-section { margin-bottom: 20px; }
        .advice-section h4 { color: var(--primary-accent); margin-bottom: 12px; font-size: 18px; }
        .advice-list { list-style: none; }
        .advice-list li { background: var(--subtle-bg-color); padding: 12px 16px; margin-bottom: 8px; border-radius: 12px; border-left: 4px solid var(--primary-accent); line-height: 1.5; }

        /* Diary & Forms */
        .diary-entry { background: var(--subtle-bg-color); border-radius: 16px; padding: 20px; margin-bottom: 16px; border-left: 4px solid var(--primary-accent); position: relative; }
        .diary-entry-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .diary-date { font-size: 14px; color: var(--primary-accent); font-weight: 600; }
        .diary-mood { font-size: 24px; }
        .diary-content { color: var(--text-color); line-height: 1.6; margin-bottom: 12px; }
        .diary-form { background: var(--card-bg-color); border-radius: 20px; padding: 24px; margin: 20px 0; box-shadow: 0 4px 20px rgba(0,0,0,0.1); display: none; }
        .diary-form.show { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; color: var(--text-color); font-weight: 600; margin-bottom: 8px; font-size: 16px; }
        .form-input, .form-textarea { width: 100%; padding: 16px; border: 2px solid var(--card-border-color); border-radius: 16px; font-family: inherit; font-size: 16px; line-height: 1.5; outline: none; transition: all 0.3s ease; background: var(--subtle-bg-color); color: var(--text-color); }
        .form-textarea { min-height: 120px; resize: vertical; }
        .form-input:focus, .form-textarea:focus { border-color: var(--primary-accent); background: var(--bg-color); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .mood-selector { display: flex; justify-content: space-around; background: var(--subtle-bg-color); border-radius: 16px; padding: 16px; margin: 12px 0; }
        .mood-option { display: flex; flex-direction: column; align-items: center; cursor: pointer; padding: 8px; border-radius: 12px; transition: all 0.3s ease; }
        .mood-option.selected { background: var(--bg-color); box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2); }
        .mood-option .mood-icon { font-size: 32px; margin-bottom: 4px; }
        .mood-option .mood-label { font-size: 12px; font-weight: 600; color: var(--secondary-text-color); }

        /* Neuro/Learn Section */
        .neuro-item { background: var(--subtle-bg-color); padding: 16px; margin-bottom: 12px; border-radius: 12px; border-left: 4px solid var(--primary-accent); cursor: pointer; transition: all 0.3s ease; }
        .neuro-item:hover { transform: translateX(5px); }
        .neuro-item strong { color: var(--primary-accent); display: block; margin-bottom: 8px; }
        .neuro-explanation { display: none; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--card-border-color); line-height: 1.6; }
        .neuro-explanation.show { display: block; animation: slideDown 0.5s ease; }
        @keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }

        /* Profile Section & Dark Mode Toggle */
        .preference-item { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--card-border-color); }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-accent); }
        input:checked + .slider:before { transform: translateX(22px); }

        /* Toast Notifications */
        .toast { 
            position: fixed; 
            top: 60px; 
            left: 50%; /* Centra el toast con respecto al app-container */
            transform: translateX(-50%) translateY(-100px); /* Ajusta para centrar y animar */
            width: calc(100% - 40px); /* Ancho dentro del app-container */
            max-width: 360px; /* Limita el ancho del toast */
            background: var(--card-bg-color); border: 1px solid var(--card-border-color); color: var(--text-color); border-radius: 12px; padding: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); opacity: 0; transition: all 0.3s ease; z-index: 1500; border-left-width: 4px; 
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { border-left-color: #4facfe; }
        .toast.warning { border-left-color: #f5576c; }
        
    </style>
</head>
<body>
    <div class="app-container">
        <div class="status-bar">EmotionSpace 💙</div>

        <div class="content-section active" id="home">
            <div class="section-header">
                <div class="section-title">Bienvenido, <span id="welcomeUsername"></span></div>
                <div class="section-subtitle">Tu espacio emocional personal</div>
            </div>

            <div class="card intro-card">
                <h3>🌟 Un momento para ti</h3>
                <p>Este es tu rincón seguro donde cada emoción tiene un lugar. Tómate un momento para respirar y conectar contigo.</p>
                <div class="breathing-circle" id="breathingCircle">Respira</div>
            </div>

            <div class="video-container">
                <h3>📹 Video de Bienvenida</h3>
                <p>Conoce más sobre el manejo emocional</p>
                <div class="video-embed"><iframe src="https://www.youtube.com/embed/tqOers0tWvI" title="Video de Bienvenida" frameborder="0" allowfullscreen></iframe></div>
            </div>

            <div class="card mood-section">
                <h3>¿Cómo te sientes ahora?</h3>
                <div class="mood-input">
                    <div class="mood-emoji" onclick="selectMood(this, 'Muy Feliz')">😄</div>
                    <div class="mood-emoji" onclick="selectMood(this, 'Feliz')">😊</div>
                    <div class="mood-emoji" onclick="selectMood(this, 'Neutral')">😐</div>
                    <div class="mood-emoji" onclick="selectMood(this, 'Triste')">😢</div>
                    <div class="mood-emoji" onclick="selectMood(this, 'Enojado')">😠</div>
                </div>
            </div>

            <div class="card mood-section">
                <h3>Estadísticas</h3>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-number" id="totalInteractions">0</div><div class="stat-label">Interacciones</div></div>
                    <div class="stat-card"><div class="stat-number" id="positiveEmotions">0%</div><div class="stat-label">Emociones Positivas</div></div>
                    <div class="stat-card"><div class="stat-number" id="currentMood">---</div><div class="stat-label">Estado Actual</div></div>
                    <div class="stat-card"><div class="stat-number" id="moodStreak">0</div><div class="stat-label">Días Seguidos</div></div>
                </div>
            </div>
        </div>

        <div class="content-section" id="emotions">
            <div class="section-header">
                <div class="section-title">Emociones</div>
                <div class="section-subtitle">Explora y gestiona tus sentimientos</div>
            </div>
            <div class="control-buttons">
                <button class="btn-mobile btn-primary" onclick="randomizeEmotions()">🎲 Emociones Aleatorias</button>
                <button class="btn-mobile btn-secondary" onclick="resetAllEmotions()">🔄 Reiniciar Todo</button>
            </div>
            <div class="emotions-grid" id="emotionsGrid"></div>
        </div>

        <div class="content-section" id="game">
            <div class="section-header">
                <div class="section-title">Relájate y Juega</div>
                <div class="section-subtitle">Juegos para calmar la mente y liberar la tensión</div>
            </div>
            
            <div class="card game-container">
                <h3>🫧 Burst de Tranquilidad</h3>
                <p>Revienta las burbujas de estrés tocándolas para liberar tensión.</p>
                <div class="game-score">
                    <div>🎯 Burbujas: <span id="bubblesPopped">0</span></div>
                    <div>⏱️ Tiempo: <span id="gameTime">60</span>s</div>
                </div>
                <div class="game-area" id="gameArea"></div>
                <div class="control-buttons">
                    <button id="startGameBtn" class="btn-mobile btn-primary" onclick="startGame()">🎮 Iniciar</button>
                    <button class="btn-mobile btn-secondary" onclick="resetGame()">🔄 Reiniciar</button>
                </div>
            </div>

            <div class="card memory-game-container">
                <h3>🧠 Memoria Emocional</h3>
                <p>Encuentra las parejas de emociones para entrenar tu concentración.</p>
                <div class="game-score">
                    <div>🎯 Intentos: <span id="memoryTries">0</span></div>
                    <div>💖 Parejas: <span id="memoryMatches">0</span>/<span id="totalPairs">6</span></div>
                </div>
                <div class="memory-game-grid" id="memoryGameArea"></div>
                <div class="control-buttons">
                    <button class="btn-mobile btn-primary" onclick="setupMemoryGame()">🎮 Iniciar</button>
                    <button class="btn-mobile btn-secondary" onclick="resetMemoryGame()">🔄 Reiniciar</button>
                </div>
            </div>

        </div>

        <div class="content-section" id="diary">
            <div class="section-header">
                <div class="section-title">Mi Diario</div>
                <div class="section-subtitle">Expresa y procesa tus emociones</div>
            </div>
            <div class="diary-stats">
                <div class="diary-stat-card"><div class="diary-stat-number" id="totalEntries">0</div><div class="diary-stat-label">Entradas</div></div>
                <div class="diary-stat-card"><div class="diary-stat-number" id="writingStreak">0</div><div class="diary-stat-label">Días Escribiendo</div></div>
            </div>
            <div class="card writing-prompt">
                <div style="font-size: 48px; margin-bottom: 12px;">💡</div>
                <div id="promptText" style="margin-bottom: 16px;">¿Qué pensamiento positivo puedes llevar contigo hoy?</div>
                <button class="btn-mobile btn-primary" onclick="getNewPrompt()">Nueva Idea</button>
            </div>
            <div class="diary-form" id="diaryForm"></div>
            <div id="diaryEntries"></div>
        </div>

        <div class="content-section" id="learn">
            <div class="section-header">
                <div class="section-title">Aprende</div>
                <div class="section-subtitle">Comprende la ciencia de las emociones</div>
            </div>
            <div class="video-container">
                <h3>📚 Video Educativo</h3>
                <p>Profundiza en el conocimiento emocional</p>
                <div class="video-embed"><iframe src="https://www.youtube.com/embed/o0cmNNGgvvg" title="Video Educativo" frameborder="0" allowfullscreen></iframe></div>
            </div>
            <div class="card neuro-section">
                <h3>🧠 Neurotransmisores y Emociones</h3>
                <p>Toca cada uno para conocer más:</p>
                <div class="neuro-list">
                    <div class="neuro-item" onclick="toggleNeuroExplanation(this)">
                        <strong>Serotonina</strong>
                        <div class="neuro-explanation"><strong>Funciones:</strong> Regula el ciclo del sueño, controla el apetito, mejora el estado de ánimo y reduce la ansiedad.<br><br><strong>Cómo aumentarla:</strong> Exposición al sol, ejercicio regular, alimentos ricos en triptófano (pavo, huevos), meditación.</div>
                    </div>
                    <div class="neuro-item" onclick="toggleNeuroExplanation(this)">
                        <strong>Dopamina</strong>
                        <div class="neuro-explanation"><strong>Funciones:</strong> Motivación, búsqueda de recompensas, aprendizaje y control motor.<br><br><strong>Cómo aumentarla:</strong> Completar tareas, escuchar música, hacer ejercicio, celebrar pequeños logros.</div>
                    </div>
                    <div class="neuro-item" onclick="toggleNeuroExplanation(this)">
                        <strong>Oxitocina</strong>
                        <div class="neuro-explanation"><strong>Funciones:</strong> Fortalece vínculos afectivos, promueve la empatía y confianza, y reduce el estrés.<br><br><strong>Cómo aumentarla:</strong> Contacto físico (abrazos), pasar tiempo con seres queridos, actos de bondad.</div>
                    </div>
                     <div class="neuro-item" onclick="toggleNeuroExplanation(this)">
                        <strong>Cortisol</strong>
                        <div class="neuro-explanation"><strong>Funciones:</strong> Es la "hormona del estrés". Prepara al cuerpo para la acción, pero en exceso es dañina.<br><br><strong>Cómo manejarlo:</strong> Sueño adecuado, técnicas de relajación, ejercicio y una dieta balanceada.</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content-section" id="profile">
            <div class="section-header">
                <div class="section-title">Mi Perfil</div>
                <div class="section-subtitle">Configura tu experiencia</div>
            </div>

            <div class="card">
                <form id="profileForm" onsubmit="saveProfile(event)">
                    <div class="form-group">
                        <label for="usernameInput" class="form-label">Nombre de Usuario</label>
                        <input type="text" id="usernameInput" class="form-input" placeholder="¿Cómo te gustaría que te llamemos?">
                    </div>
                    <button type="submit" class="btn-mobile btn-primary" style="width:100%;">Guardar Nombre</button>
                </form>
            </div>

            <div class="card">
                <h3>Preferencias</h3>
                <div class="preference-item">
                    <label for="darkModeToggle">Modo Oscuro</label>
                    <label class="switch">
                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode(this.checked)">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="card">
                <h3>Datos de la App</h3>
                <div class="control-buttons">
                    <button class="btn-mobile btn-success" onclick="exportData()">📦 Exportar Mis Datos</button>
                    <button class="btn-mobile btn-secondary" onclick="deleteAllData()">🗑️ Borrar Todos Mis Datos</button>
                </div>
            </div>
        </div>
        <div class="tab-navigation">
            <div class="tab-item active" onclick="showSection('home', this)"><div class="icon">🏠</div><div class="label">Inicio</div></div>
            <div class="tab-item" onclick="showSection('emotions', this)"><div class="icon">💖</div><div class="label">Emociones</div></div>
            <div class="tab-item" onclick="showSection('game', this)"><div class="icon">🎮</div><div class="label">Juego</div></div>
            <div class="tab-item" onclick="showSection('diary', this)"><div class="icon">📔</div><div class="label">Diario</div></div>
            <div class="tab-item" onclick="showSection('learn', this)"><div class="icon">🧠</div><div class="label">Aprende</div></div>
            <div class="tab-item" onclick="showSection('profile', this)"><div class="icon">👤</div><div class="label">Perfil</div></div>
        </div>
    </div>

    <button class="fab" onclick="toggleDiaryForm()">✍️</button>

    <div class="modal" id="emotionModal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="close-btn" onclick="closeModal()">×</button>
            <div class="modal-header">
                <div id="modalEmoji" class="modal-emoji"></div>
                <div>
                    <h3 id="modalTitle" class="section-title" style="font-size: 24px; margin: 0; text-align: left;"></h3>
                    <p id="modalDescription" class="section-subtitle" style="text-align: left; margin: 0;"></p>
                </div>
            </div>
            <div class="advice-section" id="consejosSection">
                <h4>✨ Consejos para Gestionar</h4>
                <ul id="adviceList" class="advice-list"></ul>
            </div>
             <div class="advice-section" id="actividadesSection">
                <h4>🏃 Actividades Sugeridas</h4>
                <ul id="activityList" class="advice-list"></ul>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>

    <script>
        // ===================================
        // GLOBAL STATE & CONSTANTS
        // ===================================
        const emotionsData = {
            alegria: { name: 'Alegría', icon: '😄', color: '#fdd835', description: 'Sentimiento de placer y satisfacción.',
                advice: ['Comparte tu alegría con alguien.', 'Agradece por tres cosas que te sucedieron hoy.', 'Sonríe, incluso si no tienes ganas, puede mejorar tu humor.'],
                activities: ['Escribe en un diario de gratitud.', 'Crea un "frasco de la felicidad" con notas positivas.', 'Realiza un acto de bondad al azar.']
            },
            tristeza: { name: 'Tristeza', icon: '😢', color: '#64b5f6', description: 'Pena, melancolía o desánimo.',
                advice: ['Permítete sentir sin juzgarte.', 'Habla con un amigo de confianza sobre cómo te sientes.', 'Recuerda que es una emoción temporal.'],
                activities: ['Mira una película o serie reconfortante.', 'Date un baño caliente o una ducha relajante.', 'Escucha música que te consuele.']
            },
            enojo: { name: 'Enojo', icon: '😠', color: '#e57373', description: 'Irritación, furia o indignación.',
                advice: ['Respira profundo 10 veces antes de reaccionar.', 'Identifica la causa real de tu enojo, no solo el detonante.', 'Usa frases con "Yo siento" en lugar de "Tú hiciste".'],
                activities: ['Haz 10 minutos de ejercicio intenso (saltar, correr).', 'Escribe una carta expresando todo tu enojo (no la envíes).', 'Golpea una almohada o grita en un lugar privado.']
            },
            miedo: { name: 'Miedo', icon: '😨', color: '#9575cd', description: 'Ansiedad ante un peligro o amenaza.',
                advice: ['Cuestiona tus pensamientos: ¿es un peligro real o imaginado?', 'Enfócate en lo que puedes controlar.', 'Utiliza la técnica de anclaje 5-4-3-2-1 (mira 5 cosas, toca 4, escucha 3, huele 2, saborea 1).'],
                activities: ['Practica la respiración de caja (inhala 4s, sostén 4s, exhala 4s, sostén 4s).', 'Infórmate sobre lo que temes desde una fuente confiable.', 'Da un pequeño y manejable paso hacia lo que temes.']
            },
            calma: { name: 'Calma', icon: '😌', color: '#81c784', description: 'Estado de tranquilidad y serenidad.',
                advice: ['Disfruta del momento presente sin preocuparte por el futuro.', 'Identifica qué te trajo a este estado para poder replicarlo.', 'Crea un ambiente tranquilo a tu alrededor.'],
                activities: ['Practica 5 minutos de meditación o mindfulness.', 'Escucha sonidos de la naturaleza o música instrumental.', 'Toma una taza de té de hierbas lentamente.']
            },
            estres: { name: 'Estrés', icon: '🤯', color: '#FF7043', description: 'Tensión física o emocional que reacciona a una amenaza.',
                advice: ['Prioriza tus tareas y divide los grandes proyectos en pasos pequeños.', 'Haz una pausa de 5 minutos para estirarte o caminar.', 'Recuerda que está bien no ser productivo todo el tiempo.'],
                activities: ['Practica la respiración abdominal profunda.', 'Escucha una lista de reproducción relajante.', 'Organiza tu espacio de trabajo o estudio.']
            },
            confianza: { name: 'Confianza', icon: '💪', color: '#4FC3F7', description: 'Seguridad en uno mismo.',
                advice: ['Recuerda logros pasados para reforzar tu autoestima.', 'Sal de tu zona de confort con un pequeño desafío.', 'Visualiza un resultado exitoso para una tarea importante.'],
                activities: ['Haz una lista de 5 fortalezas que tienes.', 'Aprende una nueva habilidad, por pequeña que sea.', 'Practica una postura de poder frente al espejo.']
            },
            sorpresa: { name: 'Sorpresa', icon: '😮', color: '#FBC02D', description: 'Reacción ante algo inesperado.',
                advice: ['Permítete sentir la emoción completamente antes de reaccionar.', 'Acepta lo inesperado como una oportunidad.', 'Busca el lado divertido o interesante de la situación.'],
                activities: ['Escribe lo que te sorprendió en un papel.', 'Dibuja una imagen de lo que sentiste.', 'Juega un juego de improvisación o de "adivina qué".']
            },
            frustracion: { name: 'Frustración', icon: '😤', color: '#d32f2f', description: 'Sentimiento de impotencia ante un obstáculo.',
                advice: ['Reevalúa tus expectativas: ¿son realistas?', 'Acepta que no todo se puede controlar.', 'Tómate un descanso y regresa al problema más tarde.'],
                activities: ['Haz algo que sabes hacer bien para recuperar la confianza.', 'Da una caminata o corre para liberar energía.', 'Habla con alguien que haya superado un obstáculo similar.']
            },
            esperanza: { name: 'Esperanza', icon: '🌟', color: '#4DD0E1', description: 'Creencia en un futuro positivo.',
                advice: ['Mantén en mente tus metas y el por qué las quieres lograr.', 'Busca historias de éxito o inspiración.', 'Ayuda a alguien más para sentirte útil y optimista.'],
                activities: ['Crea un "tablero de sueños" o vision board.', 'Escribe una lista de 5 cosas que esperas con ansias.', 'Planta una semilla o una planta y cuídala.']
            },
        };

        const memoryEmotions = ['😄', '😢', '😠', '😌', '🤯', '💪'];
        let emotionLevels = JSON.parse(localStorage.getItem('emotionLevels')) || {};
        let totalInteractions = parseInt(localStorage.getItem('totalInteractions')) || 0;
        let selectedMood = '';
        let diaryEntries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        let writingStreak = parseInt(localStorage.getItem('writingStreak')) || 0;
        let lastWritingDate = localStorage.getItem('lastWritingDate');
        let username = localStorage.getItem('username') || '';
        let darkModeEnabled = localStorage.getItem('darkModeEnabled') === 'true';

        // Games state
        let bubblesPopped = 0;
        let gameTime = 60;
        let gameTimer;
        let bubbleInterval;
        let memoryCards = [];
        let firstCard = null;
        let secondCard = null;
        let memoryMatches = 0;
        let memoryTries = 0;
        let isMemoryLocked = false;

        const prompts = [
            "¿Qué pensamiento positivo puedes llevar contigo hoy?",
            "¿Por qué te sientes agradecido en este momento?",
            "Describe una pequeña victoria que tuviste hoy.",
            "Si tuvieras un superpoder para manejar una emoción, ¿cuál sería y por qué?",
            "¿Qué le dirías a tu yo del pasado sobre el manejo de las emociones?",
            "Escribe sobre un momento en el que te sentiste realmente en paz.",
            "¿Cuál es el mayor desafío emocional que has superado?",
            "¿Qué meta personal relacionada con tus emociones te gustaría alcanzar esta semana?",
            "¿Qué actividad te hace sentir más conectado contigo mismo?",
            "Describe un acto de amabilidad que viste o realizaste hoy."
        ];

        // ===================================
        // UTILITY FUNCTIONS
        // ===================================
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast show ${type}`;
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        function showSection(sectionId, element) {
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(sec => sec.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            const tabItems = document.querySelectorAll('.tab-item');
            tabItems.forEach(item => item.classList.remove('active'));
            element.classList.add('active');

            // Reset games when leaving their section
            if (sectionId !== 'game') {
                resetGame();
                resetMemoryGame();
            }
        }

        function updateStats() {
            document.getElementById('totalInteractions').textContent = totalInteractions;
            
            let totalPositive = 0;
            let totalEntries = 0;
            if (diaryEntries.length > 0) {
                totalEntries = diaryEntries.length;
                const positiveMoods = ['Muy Feliz', 'Feliz', 'Neutral'];
                const positiveCount = diaryEntries.filter(entry => positiveMoods.includes(entry.mood)).length;
                totalPositive = Math.round((positiveCount / totalEntries) * 100);
            }
            document.getElementById('positiveEmotions').textContent = `${totalPositive}%`;
            document.getElementById('totalEntries').textContent = totalEntries;
            document.getElementById('currentMood').textContent = selectedMood || '---';
            document.getElementById('moodStreak').textContent = localStorage.getItem('moodStreak') || 0;
            document.getElementById('writingStreak').textContent = writingStreak;
        }

        function toggleDarkMode(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            localStorage.setItem('darkModeEnabled', isDark);
        }
        
        // ===================================
        // HOME PAGE FUNCTIONS
        // ===================================
        function updateWelcomeMessage() {
            const welcomeUsername = document.getElementById('welcomeUsername');
            welcomeUsername.textContent = username || 'Amigo';
        }

        function saveProfile(event) {
            event.preventDefault();
            const usernameInput = document.getElementById('usernameInput');
            username = usernameInput.value;
            localStorage.setItem('username', username);
            updateWelcomeMessage();
            showToast('Nombre guardado.', 'success');
        }

        function selectMood(element, mood) {
            const moodEmojis = document.querySelectorAll('.mood-emoji');
            moodEmojis.forEach(emoji => emoji.classList.remove('selected'));
            element.classList.add('selected');
            selectedMood = mood;
            
            totalInteractions++;
            localStorage.setItem('totalInteractions', totalInteractions);

            const today = new Date().toDateString();
            const lastMoodDate = localStorage.getItem('lastMoodDate');
            let currentStreak = parseInt(localStorage.getItem('moodStreak')) || 0;
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);

            if (lastMoodDate !== today) {
                if (lastMoodDate === yesterday.toDateString()) {
                    currentStreak++;
                } else {
                    currentStreak = 1;
                }
                localStorage.setItem('moodStreak', currentStreak);
                localStorage.setItem('lastMoodDate', today);
            }
            
            updateStats();
            showToast(`¡Te sientes ${mood}!`, 'success');
        }

        // ===================================
        // EMOTIONS PAGE FUNCTIONS
        // ===================================
        function renderEmotions() {
            const emotionsGrid = document.getElementById('emotionsGrid');
            emotionsGrid.innerHTML = '';
            for (const key in emotionsData) {
                const emotion = emotionsData[key];
                const level = emotionLevels[key] || 0;
                const card = document.createElement('div');
                card.className = 'emotion-card';
                card.onclick = () => showEmotionModal(key);
                card.innerHTML = `
                    <div>
                        <div class="emotion-icon" style="background-color: ${emotion.color}33; color: ${emotion.color};">${emotion.icon}</div>
                        <div class="emotion-name">${emotion.name}</div>
                    </div>
                    <div>
                        <div class="level-bar">
                            <div class="level-fill" style="width: ${level}%; background: ${emotion.color};"></div>
                        </div>
                        <div class="level-percentage">${level}%</div>
                    </div>
                `;
                emotionsGrid.appendChild(card);
            }
        }

        function showEmotionModal(key) {
            const emotion = emotionsData[key];
            const modal = document.getElementById('emotionModal');
            document.getElementById('modalEmoji').textContent = emotion.icon;
            document.getElementById('modalTitle').textContent = emotion.name;
            document.getElementById('modalDescription').textContent = emotion.description;

            const adviceList = document.getElementById('adviceList');
            adviceList.innerHTML = emotion.advice.map(item => `<li>${item}</li>`).join('');

            const activityList = document.getElementById('activityList');
            activityList.innerHTML = emotion.activities.map(item => `<li>${item}</li>`).join('');

            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('emotionModal').classList.remove('show');
        }

        function randomizeEmotions() {
            for (const key in emotionsData) {
                emotionLevels[key] = Math.floor(Math.random() * 101);
            }
            localStorage.setItem('emotionLevels', JSON.stringify(emotionLevels));
            renderEmotions();
            showToast('¡Emociones aleatorizadas!', 'success');
        }

        function resetAllEmotions() {
            emotionLevels = {};
            localStorage.removeItem('emotionLevels');
            renderEmotions();
            showToast('Todas las emociones reiniciadas', 'warning');
        }
        
        // ===================================
        // GAME PAGE FUNCTIONS
        // ===================================
        function startGame() {
            resetGame();
            const gameArea = document.getElementById('gameArea');
            const startGameBtn = document.getElementById('startGameBtn');
            startGameBtn.disabled = true;

            const createBubble = () => {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';
                const size = Math.random() * 50 + 30; // 30-80px
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * (gameArea.offsetWidth - size)}px`;
                bubble.style.animationDuration = `${Math.random() * 2 + 3}s`; // 3-5s
                bubble.onclick = () => {
                    bubble.remove();
                    bubblesPopped++;
                    document.getElementById('bubblesPopped').textContent = bubblesPopped;
                };
                gameArea.appendChild(bubble);
            };

            bubbleInterval = setInterval(createBubble, 500);
            
            gameTimer = setInterval(() => {
                gameTime--;
                document.getElementById('gameTime').textContent = gameTime;
                if (gameTime <= 0) {
                    clearInterval(gameTimer);
                    clearInterval(bubbleInterval);
                    startGameBtn.disabled = false;
                    showToast(`¡Tiempo terminado! Reventaste ${bubblesPopped} burbujas.`, 'success');
                }
            }, 1000);
        }

        function resetGame() {
            clearInterval(gameTimer);
            clearInterval(bubbleInterval);
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = '';
            bubblesPopped = 0;
            gameTime = 60;
            document.getElementById('bubblesPopped').textContent = bubblesPopped;
            document.getElementById('gameTime').textContent = gameTime;
            document.getElementById('startGameBtn').disabled = false;
        }

        function setupMemoryGame() {
            resetMemoryGame();
            const memoryGameArea = document.getElementById('memoryGameArea');
            
            const shuffledEmotions = [...memoryEmotions, ...memoryEmotions].sort(() => 0.5 - Math.random());
            
            shuffledEmotions.forEach(emoji => {
                const card = document.createElement('div');
                card.classList.add('memory-card');
                card.dataset.emoji = emoji;
                card.innerHTML = `
                    <div class="front-face" style="font-size: 32px;">${emoji}</div>
                    <div class="back-face" style="color: var(--primary-accent);">🧠</div>
                `;
                card.addEventListener('click', flipCard);
                memoryGameArea.appendChild(card);
            });
        }

        function resetMemoryGame() {
            const memoryGameArea = document.getElementById('memoryGameArea');
            memoryGameArea.innerHTML = '';
            firstCard = null;
            secondCard = null;
            memoryMatches = 0;
            memoryTries = 0;
            isMemoryLocked = false;
            document.getElementById('memoryMatches').textContent = memoryMatches;
            document.getElementById('memoryTries').textContent = memoryTries;
        }

        function flipCard() {
            if (isMemoryLocked) return;
            if (this === firstCard) return;

            this.classList.add('flip');

            if (!firstCard) {
                firstCard = this;
                return;
            }
            
            secondCard = this;
            memoryTries++;
            document.getElementById('memoryTries').textContent = memoryTries;

            checkForMatch();
        }

        function checkForMatch() {
            const isMatch = firstCard.dataset.emoji === secondCard.dataset.emoji;

            if (isMatch) {
                disableCards();
                memoryMatches++;
                document.getElementById('memoryMatches').textContent = memoryMatches;
                if (memoryMatches === memoryEmotions.length) {
                    showToast('¡Felicidades, encontraste todas las parejas!', 'success');
                }
            } else {
                unflipCards();
            }
        }

        function disableCards() {
            firstCard.removeEventListener('click', flipCard);
            secondCard.removeEventListener('click', flipCard);

            setTimeout(() => {
                firstCard.classList.add('match');
                secondCard.classList.add('match');
                resetBoard();
            }, 500);
        }

        function unflipCards() {
            isMemoryLocked = true;
            setTimeout(() => {
                firstCard.classList.remove('flip');
                secondCard.classList.remove('flip');
                resetBoard();
            }, 1500);
        }

        function resetBoard() {
            [firstCard, secondCard] = [null, null];
            isMemoryLocked = false;
        }

        // ===================================
        // DIARY PAGE FUNCTIONS
        // ===================================
        function toggleDiaryForm() {
            const form = document.getElementById('diaryForm');
            form.classList.toggle('show');
            if (form.classList.contains('show')) {
                renderDiaryForm();
            }
        }

        function renderDiaryForm() {
            const formContainer = document.getElementById('diaryForm');
            formContainer.innerHTML = `
                <form onsubmit="saveDiaryEntry(event)">
                    <div class="form-group">
                        <label class="form-label">¿Qué emoción sentiste?</label>
                        <div class="mood-selector" id="formMoodSelector">
                            ${Object.keys(emotionsData).map(key => {
                                const emotion = emotionsData[key];
                                return `
                                    <div class="mood-option" onclick="selectFormMood(this, '${key}')">
                                        <span class="mood-icon">${emotion.icon}</span>
                                        <span class="mood-label">${emotion.name}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="diaryText" class="form-label">¿Qué pasó y cómo lo manejaste?</label>
                        <textarea id="diaryText" class="form-textarea" placeholder="Escribe aquí tu experiencia..."></textarea>
                    </div>
                    <button type="submit" class="btn-mobile btn-primary" style="width:100%;">Guardar Entrada</button>
                </form>
            `;
        }

        function selectFormMood(element, moodKey) {
            const moodOptions = document.querySelectorAll('#formMoodSelector .mood-option');
            moodOptions.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        function saveDiaryEntry(event) {
            event.preventDefault();
            const selectedMoodOption = document.querySelector('#formMoodSelector .mood-option.selected');
            const moodKey = selectedMoodOption ? selectedMoodOption.onclick.toString().match(/'(.*?)'/)[1] : null;
            const text = document.getElementById('diaryText').value;

            if (!moodKey || !text) {
                showToast('Por favor, selecciona una emoción y escribe algo.', 'warning');
                return;
            }

            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            let newStreak = writingStreak;
            if (lastWritingDate !== todayStr) {
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                if (lastWritingDate === yesterdayStr) {
                    newStreak++;
                } else {
                    newStreak = 1;
                }
                writingStreak = newStreak;
                lastWritingDate = todayStr;
                localStorage.setItem('writingStreak', writingStreak);
                localStorage.setItem('lastWritingDate', lastWritingDate);
            }

            const newEntry = {
                date: today.toLocaleDateString(),
                mood: emotionsData[moodKey].icon,
                text: text
            };
            diaryEntries.push(newEntry);
            localStorage.setItem('diaryEntries', JSON.stringify(diaryEntries));
            
            updateStats();
            renderDiaryEntries();
            document.getElementById('diaryForm').classList.remove('show');
            showToast('Entrada de diario guardada con éxito.', 'success');
        }

        function renderDiaryEntries() {
            const entriesContainer = document.getElementById('diaryEntries');
            entriesContainer.innerHTML = '';
            diaryEntries.slice().reverse().forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'diary-entry';
                entryDiv.innerHTML = `
                    <div class="diary-entry-header">
                        <div class="diary-date">${entry.date}</div>
                        <div class="diary-mood">${entry.mood}</div>
                    </div>
                    <div class="diary-content">${entry.text}</div>
                `;
                entriesContainer.appendChild(entryDiv);
            });
        }

        function getNewPrompt() {
            const promptText = document.getElementById('promptText');
            const randomIndex = Math.floor(Math.random() * prompts.length);
            promptText.textContent = prompts[randomIndex];
        }

        // ===================================
        // LEARN PAGE FUNCTIONS
        // ===================================
        function toggleNeuroExplanation(element) {
            const explanation = element.querySelector('.neuro-explanation');
            explanation.classList.toggle('show');
        }

        // ===================================
        // PROFILE PAGE FUNCTIONS
        // ===================================
        function exportData() {
            const data = {
                username: username,
                emotionLevels: emotionLevels,
                diaryEntries: diaryEntries,
                stats: {
                    totalInteractions: totalInteractions,
                    moodStreak: parseInt(localStorage.getItem('moodStreak')) || 0,
                    writingStreak: writingStreak
                },
                darkModeEnabled: darkModeEnabled
            };
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'emotionspace_data.json';
            a.click();
            URL.revokeObjectURL(url);
            showToast('Datos exportados.', 'success');
        }

        function deleteAllData() {
            if (confirm('¿Estás seguro de que quieres borrar todos tus datos? Esta acción es irreversible.')) {
                localStorage.clear();
                location.reload();
                showToast('Todos los datos han sido borrados.', 'warning');
            }
        }

        // ===================================
        // INITIALIZATION
        // ===================================
        window.onload = () => {
            updateWelcomeMessage();
            updateStats();
            renderEmotions();
            renderDiaryEntries();
            document.getElementById('darkModeToggle').checked = darkModeEnabled;
            toggleDarkMode(darkModeEnabled);
            setupMemoryGame();
        };

    </script>
</body>
</html>